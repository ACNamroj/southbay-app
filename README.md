# Southbay App (sby-app)

Frontend web application built with Umi Max (@umijs/max), React, TypeScript, and Ant Design. It provides authenticated pages (login/forgot/reset password) and feature modules (Stores, People, Users, Segmentation) with a Pro Layout.

This document describes the stack, requirements, how to run/build, available scripts, environment variables, project structure, and licensing notes.

Last updated: 2025-12-02

## Overview

- Framework: Umi Max 4 (`@umijs/max`) with configuration in `.umirc.ts`
- Language: TypeScript
- UI: Ant Design 5 + Ant Design Pro Components
- Routing: Declared routes in `.umirc.ts` (no conventional routes)
- State/Models: Umi model plugin
- i18n: Umi locale plugin, default `es-ES`
- Mock API: Umi mock via `mock/` during development

## Requirements

- Node.js: 18+ recommended (Husky v9 requires Node 18+). TODO: Confirm exact minimum version used in deployment.
- Package manager: pnpm (lockfile present, and `.umirc.ts` sets `npmClient: 'pnpm'`)
- Git (for Husky hooks, optional)

## Getting Started

1. Install dependencies

   ```bash
   pnpm install
   ```

2. Start the dev server

   ```bash
   pnpm dev
   # or
   pnpm start
   ```

   Umi will start the app on http://localhost:8000 (or the next available port).

3. Build for production

   ```bash
   pnpm build
   ```

   The production build is output to the `dist/` directory by Umi.

## Scripts

Defined in `package.json`:

- `dev`: Run the Umi dev server (`max dev`).
- `start`: Alias for `dev`.
- `build`: Build the app for production (`max build`).
- `lint`: Prettier check (`pnpm format --cache --check`).
- `typecheck`: TypeScript `tsc --noEmit`.
- `lint-staged`: Run staged-file formatting (used by Husky pre-commit).
- `setup` / `postinstall`: Run Umi setup tasks (`max setup`). Executed on install and can be invoked manually.
- `prepare`: Initialize Husky git hooks (`husky`).
- `format`: Run Prettier across the repository.
- `test`: Run Vitest in CI mode.
- `test:watch`: Vitest watch.
- `test:coverage`: Vitest with coverage output.

Run with pnpm, for example: `pnpm dev`, `pnpm build`, `pnpm format`.

## Environment Variables

- `BASE_URL`: Base URL for backend API requests.
- Used in `src/services/client.ts`.
- In development it is defined via Umi config: `.umirc.ts -> define: { 'process.env.BASE_URL': 'http://localhost:8080' }`.
- For other environments, set a value at build time using Umi's `define` config or environment injection. Add an environment-specific define in `.umirc.*.ts` or inject via CI pipelines.
- `.env.example` shows expected keys; create `.env.local` (not committed) for local overrides and ensure CI/CD sets `BASE_URL` for staging/production.

Other common variables:

- `NODE_ENV`: Used for development checks in some services (e.g., `src/services/login/loginService.ts`).

## Entry Points and Routing

- Runtime/layout configuration: `src/app.tsx` (Umi runtime config: layout, request config, initial state).
- Routes: managed in `.umirc.ts` under the `routes` array (login, forgot/reset password, home, stores, people, users, segmentation).
- Page components live in `src/pages/**` and are referenced by the route config.

## Project Structure

Top-level (selected):

```
.
├─ .umirc.ts                 # Umi configuration (theme, plugins, routes, env vars, npmClient)
├─ index.ts                  # Exports app logos (for embedding/consumers)
├─ mock/                     # Umi mock API handlers (dev only)
├─ public/                   # Static assets served as-is (e.g., favicons under /icons)
├─ src/
│  ├─ app.tsx               # Umi runtime config (layout, request, initial state)
│  ├─ pages/                # Route pages (Login, ForgotPassword, ResetPassword, Home, Stores, People, Users, Segmentation)
│  ├─ layout/               # Layout components, menu utils, request interceptors
│  ├─ components/           # Reusable UI components
│  ├─ services/             # API client and domain services (auth, users, etc.)
│  ├─ models/               # Umi model files
│  ├─ locales/              # i18n resources (default es-ES)
│  ├─ utils/                # Utility functions (auth tokens, formatting, etc.)
│  ├─ assets/               # Logos and icons
│  └─ .umi/                 # Generated by Umi (do not edit)
├─ typings.d.ts              # Project typings
├─ tsconfig.json             # TypeScript configuration (extends from Umi-generated tsconfig)
├─ package.json              # Scripts and dependencies
├─ pnpm-lock.yaml            # pnpm lockfile
└─ README.md                 # This file
```

Notes:

- Ant Design theme is customized in `.umirc.ts` under `antd.theme.token`.
- Favicons configured via `.umirc.ts -> favicons` (served from `public/icons`).
- Access control, models, locale, and request plugins are enabled in `.umirc.ts`.

## Mock API

During development, Umi serves mock routes from the `mock/` directory. This allows UI development without a live backend. Remove or disable mocks as needed for integration testing.

## Testing

Vitest + React Testing Library is configured. Run locally:

- `pnpm test` – run once in CI mode.
- `pnpm test:watch` – watch mode.
- `pnpm test:coverage` – run with coverage output.

## Linting and Formatting

- Prettier is configured via scripts: `pnpm format` to format the codebase.
- `prettier-plugin-organize-imports` and `prettier-plugin-packagejson` are included.
- `lint-staged` is configured in `lint-staged.config.js` and runs via Husky pre-commit (`.husky/pre-commit`).
- Husky (`prepare` script) is included to enable Git hooks; ensure hooks are installed with `pnpm husky install` after cloning.

## Design System

- Theme tokens live in `src/theme/tokens.ts` (JS) and `src/theme/variables.less` (CSS variables). Ant Design pulls from `antdThemeTokens` in `.umirc.ts`; styles use CSS variables via `src/global.less`.
- Spacing scale: `--space-xxs` (4px) to `--space-xl` (32px). Typography scale: base 16px with heading sizes ( `--heading-1-size` 32px, `--heading-2-size` 24px, etc.).
- Use `var(--primary-color)`, `var(--text-color)`, and spacing/typography tokens for buttons/forms/tables to avoid ad-hoc values.
- Shared components belong under `src/components/`; add Storybook (optional) if you want interactive docs for those components.

## Deployment

- Build the production bundle with `pnpm build` (outputs to `dist/`).
- Serve the `dist/` directory with your preferred static hosting solution or reverse proxy.
- Environment configuration: ensure `BASE_URL` (and any other required values) are set appropriately at build time. TODO: Document the deployment process, hosting platform, and CI/CD steps used by the team.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.

## References

- Umi Max docs: https://umijs.org/docs/max/introduce
- Ant Design: https://ant.design/
- Ant Design Pro Components: https://procomponents.ant.design/
